# Advanced Sigil Analyzer

## Description

The Advanced Sigil Analyzer is a multi-functional Python desktop application designed for extracting, analyzing, and interacting with sigils and symbols from PDF documents, particularly those of an esoteric or historical nature. It combines PDF parsing, Optical Character Recognition (OCR), image processing, and Large Language Model (LLM) integration to provide a comprehensive toolkit for researchers and enthusiasts.
[A youtube Tutorial is shown here](https://youtu.be/VOzuVdyA3LQ)
The application allows users to:
1.  **Scan PDFs**: Extract textual entries and visual sigils from PDF documents, with an option to use OCR for image-based PDFs. Visual overlays during scanning highlight detected elements.
2.  **Query Data**: Load and search through the extracted data, including text and associated sigil images.
3.  **Visual Sigil Search**: Draw a sigil on a canvas and find the most visually similar sigils from the extracted database using image hashing.
4.  **LLM Chat & Analysis**: Select an extracted sigil and interact with an LLM (Gemini or OpenAI) to get an analysis, providing the sigil image and its contextual information from the PDF.

## Features

* **Tabbed Interface**:
    * **PDF Scanner**:
        * Select a folder and PDF for processing.
        * Define page ranges for scanning.
        * Optional OCR mode for image-based PDFs.
        * Visual preview of the current page being scanned with overlays highlighting detected text, headings, and potential sigils.
        * Extraction of dictionary-like entries (heading, class, description, references).
        * Extraction of individual sigil images with associated metadata.
        * Progress bar and detailed logging.
        * Output saved to a JSON file (`sigil_dictionary_extracted_with_sigils_metadata.json`) and sigil images to `extracted_sigil_images/` directory.
    * **Data Query**:
        * Load the JSON data generated by the scanner.
        * Search entries by keywords (heading, class, description, references, sigil source text).
        * Display detailed entry information, including links to view extracted sigil images in a popup.
    * **Sigil Search (Draw)**:
        * Drawing canvas to sketch a sigil.
        * Image similarity search (using perceptual hashing - pHash) against the database of extracted sigil images.
        * Displays the top 10 visual matches with their images and contextual information.
        * Option to send a matched sigil to the LLM Chat tab for further analysis.
    * **LLM Chat & Analysis**:
        * Select LLM provider (Gemini or OpenAI).
        * Configure API keys.
        * Test API key connectivity.
        * Display an "active sigil" (selected from the Sigil Search tab).
        * Chat interface to ask questions about the active sigil.
        * Sends the sigil image and its contextual metadata (heading, description from PDF, etc.) to the LLM for analysis.
        * Displays the LLM's response in the chat history.

* **Asynchronous LLM Calls**: LLM interactions are handled asynchronously to keep the GUI responsive.
* **Image Processing**: Uses Pillow for image manipulation, PyMuPDF for PDF rendering, and ImageHash for similarity.

## Prerequisites

* **Python 3.7+**
* **Tesseract OCR Engine**:
    * Required if you intend to use the OCR mode for image-based PDFs.
    * Installation varies by OS:
        * **Windows**: Download installer from Tesseract at UB Mannheim or official Tesseract GitHub. **Ensure you add Tesseract to your system's PATH during installation.**
        * **macOS**: `brew install tesseract`
        * **Linux (Debian/Ubuntu)**: `sudo apt-get install tesseract-ocr`
    * You might also need language data packs (e.g., `tesseract-ocr-eng` for English).
* **Python Libraries**: Install using pip:
    ```bash
    pip install Pillow PyMuPDF pdfplumber pytesseract imagehash pandas google-generativeai openai
    ```
    *(Note: `pandas` is required by `pytesseract` for `image_to_data` with DataFrame output).*

## How to Run

1.  **Save the Code**: Save the application code as a Python file (e.g., `advanced_sigil_analyzer.py`).
2.  **Install Prerequisites**: Ensure all prerequisites listed above are installed.
3.  **Configure API Keys (Optional but Recommended for LLM features)**:
    * You can set your API keys as environment variables:
        * `GOOGLE_API_KEY` for Gemini
        * `OPENAI_API_KEY` for OpenAI
    * Alternatively, you can enter them directly in the "LLM Chat & Analysis" tab within the application (these will only be stored for the current session).
4.  **Run the Script**:
    ```bash
    python advanced_sigil_analyzer.py
    ```
5.  **Using the Application**:
    * **PDF Scanner Tab**:
        * Click "Select PDF Folder" to choose the directory containing your PDF(s).
        * Select a PDF from the list.
        * Adjust "Start Page" and "End Page" if needed.
        * Check "Use OCR" if your PDF is image-based.
        * Click "Scan Selected PDF". Output will be saved to `sigil_dictionary_extracted_with_sigils_metadata.json` and images to `extracted_sigil_images/`.
    * **Data Query Tab**:
        * Click "Load Scanned Data" to load the JSON file generated by the scanner.
        * Use the search bar to filter entries.
        * Click "View" next to a sigil path to see the image.
    * **Sigil Search (Draw) Tab**:
        * Ensure scanned data is loaded (it will attempt to load if not already).
        * Draw a symbol in the canvas.
        * Click "Search Drawn Sigil".
        * Click "Analyze with LLM" on a match to send it to the LLM Chat tab.
    * **LLM Chat & Analysis Tab**:
        * Select your LLM provider.
        * Enter and test your API key if not set via environment variables.
        * If a sigil is selected from the "Sigil Search" tab, it will appear as the "Active Sigil".
        * Type your questions about the active sigil and click "Send".

## Configuration Notes

* **Tesseract Path**: If Tesseract is not in your system's PATH after installation (especially on Windows), you may need to uncomment and set the path to `tesseract.exe` in the script:
    ```python
    # pytesseract.pytesseract.tesseract_cmd = r'C:\Program Files\Tesseract-OCR\tesseract.exe' 
    ```
* **Output Files**:
    * `sigil_dictionary_extracted_with_sigils_metadata.json`: Stores all extracted textual data and metadata about sigils, including paths to their images.
    * `extracted_sigil_images/`: Directory where individual sigil image files (PNGs) are saved.

## Known Issues / Future Enhancements

* **Sigil Detection Heuristics**: The current methods for identifying sigils (especially in non-OCR mode and for complex graphical sigils) are basic and can be improved. Font analysis or more advanced character/shape recognition could enhance accuracy.
* **OCR Accuracy**: OCR quality depends on the PDF's image quality.
* **LLM Prompt Engineering**: The prompts sent to the LLMs can be further refined for more specific or nuanced analyses.
* **UI for Large Datasets**: Displaying a very large number of search results or sigil matches might become less performant. Pagination or virtualized lists could be considered.
* **Error Handling**: More granular error handling for file operations and API calls can be added.
* **Direct LLM Image Upload (Alternative to Drawing)**: Allow users to upload an image file directly for LLM analysis or visual search.

